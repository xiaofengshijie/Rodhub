local Repository = "https://raw.githubusercontent.com/RectangularObject/LinoriaLib/main/"
local Library = loadstring(game:HttpGet(Repository .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(Repository .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(Repository .. "addons/SaveManager.lua"))()

-- 永久密钥系统
local PermanentKeys = {"RODHUB-PERMA-ADMIN-1234"}
local KeyAttempts = 0
local MaxAttempts = 5

-- 创建验证窗口
local KeyWindow = Library:CreateWindow({
    Title = "Rodhub 验证系统",
    Center = true,
    AutoShow = true,
    Size = UDim2.new(0, 450, 0, 300)
})

-- 创建验证标签页
local AuthTab = KeyWindow:AddTab("密钥验证")
local AuthGroup = AuthTab:AddLeftGroupbox("输入密钥")

-- 密钥输入框
local KeyInput = AuthGroup:AddInput("KeyInput", {
    Default = "",
    Numeric = false,
    Finished = false,
    Text = "输入永久密钥",
    Placeholder = "RODHUB-PERMA-ADMIN-1234",
})

-- 验证按钮（关键修复代码）
local VerifyButton = AuthGroup:AddButton("验证密钥", function()
    local inputKey = KeyInput:GetValue()
    
    if inputKey == "" then
        Library:Notify("请输入密钥", 3)
        return
    end
    
    -- 验证逻辑
    local isValid = false
    for _, key in ipairs(PermanentKeys) do
        if inputKey == key then
            isValid = true
            break
        end
    end
    
    if isValid then
        Library:Notify("验证成功！", 5)
        
        -- 销毁验证窗口
        KeyWindow:Destroy()
        
        -- 确保窗口完全销毁
        wait(0.1)
        
        -- 创建主界面
        CreateMainUI()
    else
        KeyAttempts = KeyAttempts + 1
        Library:Notify("无效密钥 尝试: "..KeyAttempts.."/"..MaxAttempts, 4)
    end
end)

-- 主界面创建函数
function CreateMainUI()
    -- 创建主窗口
    local MainWindow = Library:CreateWindow({
        Title = "Rodhub Premium",
        Center = true,
        AutoShow = true,
        Size = UDim2.new(0, 600, 0, 500)
    })
    
    -- 添加主功能
    local MainTab = MainWindow:AddTab("主功能")
    local MainGroup = MainTab:AddLeftGroupbox("核心功能")
    
    -- 添加大尺寸按钮
    MainGroup:AddButton("玩家ESP", function()
        Library:Notify("ESP已激活", 3)
    end):SetSize(UDim2.new(1, -20, 0, 48))
    
    MainGroup:AddButton("速度加速", function()
        Library:Notify("速度已提升", 3)
    end):SetSize(UDim2.new(1, -20, 0, 48))
    
    MainGroup:AddButton("资源收集", function()
        Library:Notify("自动收集中...", 3)
    end):SetSize(UDim2.new(1, -20, 0, 48))
    
    -- 设置水印
    Library:SetWatermarkVisibility(true)
    Library:SetWatermark("Rodhub Premium | 已激活")
end

-- 添加回车键支持
KeyInput:OnEnter(function()
    VerifyButton:Callback()
end)

-- 提示信息
Library:Notify("请输入密钥: RODHUB-PERMA-ADMIN-1234", 10)
